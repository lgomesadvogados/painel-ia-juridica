<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Jurídico IA - L Gomes</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a2e8b6f9ad.js" crossorigin="anonymous"></script>
  <style>
    body { font-family: 'Roboto', sans-serif; background: #121212; color: #ffd700; margin: 0; }
    header { background-color: #000; padding: 20px; text-align: center; }
    header img { max-height: 60px; }
    .container { max-width: 900px; margin: auto; padding: 20px; }
    .field textarea { width: 100%; height: 80px; background: #222; color: #ffd700; border: 1px solid #444; padding: 8px; }
    .banner { background: #333; border: 2px solid #ffd700; padding: 10px; margin: 15px 0; display: none; }
    .timeline { border-left: 2px solid #ffd700; padding-left: 15px; margin-top: 20px; }
    .timeline div { margin-bottom: 15px; }
    .switch { position: fixed; top: 20px; right: 20px; cursor: pointer; }
    .switch i { font-size: 1.5em; }
    .dark-mode { background: #f4f4f4; color: #222; }
    .dark-mode textarea, .dark-mode .banner { background: #eee; color: #222; border-color: #333; }
  </style>
</head>
<body>
  <header>
    <img src="Logo.png" alt="L Gomes Advogados">
  </header>
  <div class="container">
    <div class="switch" onclick="toggleTheme()"><i class="fas fa-adjust"></i></div>

    <h2>Painel IA Jurídico</h2>
    <div class="field">
      <label><strong>Publicação/Caso:</strong></label>
      <textarea id="caseText" placeholder="Cole aqui a publicação ou descrição do caso"></textarea>
    </div>
    <button onclick="startCase()">▶ Iniciar Caso Automático</button>

    <div id="bannerThiago" class="banner"><i class="fas fa-exclamation-circle"></i> Pendência para Dr. Thiago</div>
    <div id="bannerLorrana" class="banner"><i class="fas fa-exclamation-circle"></i> Pendência para Dra. Lorrana</div>

    <div id="historyList"></div>
    <div id="timelog" class="timeline"></div>
  </div>
  <div class="footer" style="text-align:center; margin-top:30px; font-size:0.9em; color:#aaa;">Painel IA Jurídico • Equipe L Gomes Advogados</div>

<script>
const TRAIN = JSON.parse(localStorage.getItem('train') || '{}');
let history = JSON.parse(localStorage.getItem('cases') || '[]');
const API_KEY = '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';

function saveTrain(key, value) {
  TRAIN[key] = value;
  localStorage.setItem('train', JSON.stringify(TRAIN));
}
function saveHistory(caseObj) {
  history.unshift(caseObj);
  localStorage.setItem('cases', JSON.stringify(history));
  renderHistory();
}
function renderHistory() {
  document.getElementById('historyList').innerHTML = '<h3>Histórico de casos:</h3>';
  history.forEach((c, i) => {
    const div = document.createElement('div');
    div.innerHTML = `#${i + 1} – ${c.case.slice(0, 40)}... <button onclick="loadCase(${i})">Abrir</button>`;
    document.getElementById('historyList').appendChild(div);
  });
}
function showBanner(id) {
  document.getElementById(id).style.display = 'block';
}
function addLogStep(agent, msg) {
  const container = document.getElementById('timelog');
  const step = document.createElement('div');
  const time = new Date().toLocaleString();
  step.innerHTML = `<strong>${agent}</strong> [${time}]:<br>${msg}`;
  container.appendChild(step);
}
async function callAgent(agent, prompt) {
  const t0 = Date.now();
  addLogStep(agent, `<em>pensando...</em>`);
  const resp = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST", headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${API_KEY}`
    },
    body: JSON.stringify({ model: "gpt-4", messages: [{ role: "user", content: prompt }] })
  }).then(r => r.json());
  const dt = Date.now() - t0;
  addLogStep(agent, `${resp.choices[0].message.content} <br><small>Tempo: ${dt} ms</small>`);
  return resp.choices[0].message.content;
}
async function startCase() {
  const caseTxt = document.getElementById('caseText').value.trim();
  if (!caseTxt) { alert('Insira um caso para iniciar.'); return; }
  document.getElementById('timelog').innerHTML = '';
  showBanner('bannerLorrana');
  showBanner('bannerThiago');

  const obj = { case: caseTxt, steps: [] };

  const p1 = TRAIN.ass1 || "Analise o caso e indique ações necessárias.";
  const r1 = await callAgent('Assistente Jurídico', p1 + "\n\n" + caseTxt);
  obj.steps.push({ agent: 'Assistente Jurídico', text: r1 });

  const p2 = TRAIN.ass2 || "Com base acima, elabore petição.";
  const r2 = await callAgent('Estagiário de IA', p2 + "\n\n" + r1);
  obj.steps.push({ agent: 'Estagiário de IA', text: r2 });

  const p3 = TRAIN.ass3 || "Revise e adapte ao padrão do escritório.";
  const r3 = await callAgent('Analista Jurídico', p3 + "\n\n" + r2);
  obj.steps.push({ agent: 'Analista Jurídico', text: r3 });

  const p4 = TRAIN.ass4 || "Audite, comente e sinalize dúvidas.";
  const r4 = await callAgent('Auditor Jurídico', p4 + "\n\n" + r3);
  obj.steps.push({ agent: 'Auditor Jurídico', text: r4 });

  const p5 = TRAIN.ass5 || "Resuma e gere relatório final.";
  const r5 = await callAgent('Protocolista', p5 + "\n\n" + r4);
  obj.steps.push({ agent: 'Protocolista', text: r5 });

  saveHistory(obj);
}
function toggleTheme() {
  document.body.classList.toggle('dark-mode');
  const isDark = document.body.classList.contains('dark-mode');
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
}
if (localStorage.getItem('theme') === 'dark') {
  document.body.classList.add('dark-mode');
}
renderHistory();
</script>
</body>
</html>
